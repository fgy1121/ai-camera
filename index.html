<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI å¥³å‹æ‹ç…§åŠ©æ‰‹ 9.0</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

video, canvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  object-fit: cover;
}

#overlay {
  position: fixed;
  width: 100vw;
  height: 100vh;
  pointer-events: none;
}

.line {
  position: absolute;
  background: rgba(255,255,255,0.4);
}

.vertical { width: 2px; height: 100%; }
.horizontal { height: 2px; width: 100%; }

.golden-point {
  position: absolute;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: white;
  transform: translate(-50%, -50%);
  opacity: 0.6;
}

.highlight {
  background: lime !important;
  box-shadow: 0 0 20px lime;
  opacity: 1;
}

#centerDot {
  position: absolute;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: red;
  transform: translate(-50%, -50%);
}

#tipText {
  position: fixed;
  bottom: 120px;
  width: 100%;
  text-align: center;
  color: white;
  font-size: 18px;
  font-weight: bold;
}

#scoreText {
  position: fixed;
  bottom: 90px;
  width: 100%;
  text-align: center;
  color: yellow;
  font-size: 20px;
  font-weight: bold;
}

#readyHint {
  position: fixed;
  bottom: 170px;
  width: 100%;
  text-align: center;
  font-size: 22px;
  color: lime;
  font-weight: bold;
  display: none;
}

#shutterBtn {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  width: 80px;
  height: 80px;
  border-radius: 50%;
  border: 6px solid white;
  background: red;
  transition: 0.3s;
}
</style>
</head>

<body>

<video class="input_video" autoplay playsinline muted></video>
<canvas class="output_canvas"></canvas>

<div id="overlay">
  <!-- é»„é‡‘çº¿ -->
  <div class="line vertical" style="left:38.2%;"></div>
  <div class="line vertical" style="left:61.8%;"></div>
  <div class="line horizontal" style="top:38.2%;"></div>

  <!-- é»„é‡‘äº¤å‰ç‚¹ -->
  <div id="gp1" class="golden-point" style="left:38.2%; top:38.2%;"></div>
  <div id="gp2" class="golden-point" style="left:61.8%; top:38.2%;"></div>

  <!-- äººç‰©ä¸­å¿ƒç‚¹ -->
  <div id="centerDot"></div>
</div>

<div id="tipText"></div>
<div id="scoreText"></div>
<div id="readyHint">å·²å¸é™„é»„é‡‘ç‚¹ ğŸ“¸</div>
<button id="shutterBtn"></button>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
const video = document.querySelector(".input_video");
const canvas = document.querySelector(".output_canvas");
const ctx = canvas.getContext("2d");
const shutterBtn = document.getElementById("shutterBtn");

let currentScore = 0;

const pose = new Pose({
  locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
});

pose.setOptions({
  modelComplexity: 1,
  smoothLandmarks: true,
  minDetectionConfidence: 0.6,
  minTrackingConfidence: 0.6
});

pose.onResults(onResults);

function onResults(results) {

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);

  if (!results.poseLandmarks) return;

  const lm = results.poseLandmarks;

  const leftShoulder = lm[11];
  const rightShoulder = lm[12];
  const leftEye = lm[2];
  const rightEye = lm[5];

  const centerX = (leftShoulder.x + rightShoulder.x) / 2;
  const eyeY = (leftEye.y + rightEye.y) / 2;

  const centerDot = document.getElementById("centerDot");
  centerDot.style.left = (centerX * 100) + "%";
  centerDot.style.top = (eyeY * 100) + "%";

  const goldenPoints = [
    {x:0.382, y:0.382, el:document.getElementById("gp1")},
    {x:0.618, y:0.382, el:document.getElementById("gp2")}
  ];

  let bestDistance = 999;
  let bestPoint = null;

  goldenPoints.forEach(p => {
    const dx = centerX - p.x;
    const dy = eyeY - p.y;
    const dist = Math.sqrt(dx*dx + dy*dy);
    if (dist < bestDistance) {
      bestDistance = dist;
      bestPoint = p;
    }
    p.el.classList.remove("highlight");
  });

  let score = 100 - bestDistance * 400;
  let tips = [];

  if (bestDistance < 0.05) {
    bestPoint.el.classList.add("highlight");
  } else {
    if (centerX < bestPoint.x) tips.push("å¾€å³ä¸€ç‚¹ ğŸ‘‰");
    if (centerX > bestPoint.x) tips.push("å¾€å·¦ä¸€ç‚¹ ğŸ‘ˆ");
    if (eyeY < bestPoint.y) tips.push("å¾€ä¸‹ä¸€ç‚¹ â¬‡");
    if (eyeY > bestPoint.y) tips.push("å¾€ä¸Šä¸€ç‚¹ â¬†");
  }

  if (score < 0) score = 0;
  if (score > 100) score = 100;

  currentScore = score;

  const tipText = document.getElementById("tipText");
  const scoreText = document.getElementById("scoreText");
  const readyHint = document.getElementById("readyHint");

  tipText.innerText = tips.length === 0 ? "æ„å›¾å·²å¸é™„é»„é‡‘ç‚¹ ğŸ‘" : tips.join(" | ");
  scoreText.innerText = "è¯„åˆ†ï¼š" + Math.round(score);

  if (score >= 90) {
    shutterBtn.style.background = "lime";
    readyHint.style.display = "block";
  } else {
    shutterBtn.style.background = "red";
    readyHint.style.display = "none";
  }
}

const camera = new Camera(video, {
  onFrame: async () => await pose.send({ image: video }),
  width: 640,
  height: 480
});
camera.start();

shutterBtn.addEventListener("click", () => {
  if (currentScore < 80) {
    alert("å†å¾®è°ƒä¸€ä¸‹æ›´å®Œç¾ ğŸ‘");
    return;
  }
  const link = document.createElement("a");
  link.download = "golden-photo.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
});
</script>

</body>
</html>
