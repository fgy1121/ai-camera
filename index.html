<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>AIæ‘„å½±è¾…åŠ©</title>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
  <style>
    body {
        margin: 0;
        overflow: hidden;
        background: black;
}
    video {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: cover;
}
    canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
}
    #tip {
      position:fixed;
      top:20px;
      left:50%;
      transform:translateX(-50%);
      color:white;
      font-size:24px;
      background:rgba(0,0,0,0.5);
      padding:10px 20px;
      border-radius:20px;
    }
    #guideBox {
  position: fixed;
  top: 50%;
  left: 50%;
  width: 60vw;
  height: 70vh;
  transform: translate(-50%, -50%);
  border: 4px solid red;
  border-radius: 20px;
  pointer-events: none;
}

#tipText {
  position: fixed;
  bottom: 80px;
  width: 100%;
  text-align: center;
  font-size: 22px;
  color: white;
  font-weight: bold;
}
  </style>
</head>
<body>
  <video class="input_video" autoplay playsinline muted></video>
  <canvas class="output_canvas"></canvas>
  <div id="guideBox"></div>
  <div id="tipText">æ­£åœ¨è¯†åˆ«...</div>
  <div id="tip">æ­£åœ¨æ£€æµ‹...</div>

<script>
const video = document.querySelector('.input_video');
const canvas = document.querySelector('.output_canvas');
const ctx = canvas.getContext('2d');
const tip = document.getElementById('tip');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const pose = new Pose({
  locateFile: file =>
    `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
});

pose.setOptions({
  modelComplexity: 0,
  smoothLandmarks: true,
  minDetectionConfidence: 0.5,
  minTrackingConfidence: 0.5
});

pose.onResults(results => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);

  if (results.poseLandmarks) {
  const nose = results.poseLandmarks[0]; // é¼»å­ä½ç½®
  const x = nose.x;
  const y = nose.y;

  const guideBox = document.getElementById("guideBox");
  const tipText = document.getElementById("tipText");

  let score = 100;
  let tip = "å®Œç¾ï¼Œå¯ä»¥æ‹ï¼";

  if (x < 0.4) {
    tip = "å¾€å³ä¸€ç‚¹ ğŸ‘‰";
    score -= 30;
  } else if (x > 0.6) {
    tip = "å¾€å·¦ä¸€ç‚¹ ğŸ‘ˆ";
    score -= 30;
  }

  if (y < 0.3) {
    tip = "æ‰‹æœºä½ä¸€ç‚¹ ğŸ“±â¬‡ï¸";
    score -= 30;
  } else if (y > 0.7) {
    tip = "äººå¾€å‰ä¸€ç‚¹ ğŸ™†";
    score -= 30;
  }

  if (score >= 80) {
    guideBox.style.borderColor = "lime";
  } else {
    guideBox.style.borderColor = "red";
  }

  tipText.innerText = tip + " è¯„åˆ†ï¼š" + score;
}

});

const camera = new Camera(video, {
  onFrame: async () => {
    await pose.send({image: video});
  },
  width: 640,
  height: 480
});
video.setAttribute("playsinline", true);    
camera.start();
</script>
</body>
</html>
