<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI å¥³å‹æ‹ç…§åŠ©æ‰‹ 10.0</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

video, canvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  object-fit: cover;
}

.line {
  position: absolute;
  background: rgba(255,255,255,0.4);
}
.vertical { width:2px;height:100%; }
.horizontal { height:2px;width:100%; }

#overlay {
  position: fixed;
  width:100vw;
  height:100vh;
  pointer-events:none;
}

#tipText {
  position: fixed;
  bottom:120px;
  width:100%;
  text-align:center;
  color:white;
  font-size:18px;
  font-weight:bold;
}

#scoreText {
  position: fixed;
  bottom:90px;
  width:100%;
  text-align:center;
  color:yellow;
  font-size:20px;
  font-weight:bold;
}

#readyHint {
  position: fixed;
  bottom:170px;
  width:100%;
  text-align:center;
  font-size:22px;
  color:lime;
  font-weight:bold;
  display:none;
}

#shutterBtn {
  position: fixed;
  bottom:30px;
  left:50%;
  transform:translateX(-50%);
  width:80px;
  height:80px;
  border-radius:50%;
  border:6px solid white;
  background:red;
  transition:0.3s;
}
</style>
</head>

<body>

<video class="input_video" autoplay playsinline muted></video>
<canvas class="output_canvas"></canvas>

<div id="overlay">
  <div class="line vertical" style="left:38.2%;"></div>
  <div class="line vertical" style="left:61.8%;"></div>
  <div class="line horizontal" style="top:38.2%;"></div>
</div>

<div id="tipText"></div>
<div id="scoreText"></div>
<div id="readyHint">æ„å›¾+æ˜¾ç˜¦è§’åº¦è¾¾æ ‡ ğŸ“¸</div>
<button id="shutterBtn"></button>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
const video=document.querySelector(".input_video");
const canvas=document.querySelector(".output_canvas");
const ctx=canvas.getContext("2d");
const shutterBtn=document.getElementById("shutterBtn");

let currentScore=0;

const pose=new Pose({
 locateFile:file=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
});

pose.setOptions({
 modelComplexity:1,
 smoothLandmarks:true,
 minDetectionConfidence:0.6,
 minTrackingConfidence:0.6
});

pose.onResults(onResults);

function onResults(results){

 canvas.width=video.videoWidth;
 canvas.height=video.videoHeight;
 ctx.drawImage(results.image,0,0,canvas.width,canvas.height);

 if(!results.poseLandmarks)return;

 const lm=results.poseLandmarks;

 const leftShoulder=lm[11];
 const rightShoulder=lm[12];
 const leftHip=lm[23];
 const rightHip=lm[24];
 const leftEye=lm[2];
 const rightEye=lm[5];

 const shoulderWidth=Math.abs(leftShoulder.x-rightShoulder.x);
 const hipWidth=Math.abs(leftHip.x-rightHip.x);

 const bodyThicknessRatio=shoulderWidth/hipWidth;

 const centerX=(leftShoulder.x+rightShoulder.x)/2;
 const eyeY=(leftEye.y+rightEye.y)/2;

 let score=100;
 let tips=[];

 // ===== é»„é‡‘æ„å›¾ =====
 const goldenX1=0.382;
 const goldenX2=0.618;
 const goldenY=0.382;

 const distX=Math.min(Math.abs(centerX-goldenX1),Math.abs(centerX-goldenX2));
 const distY=Math.abs(eyeY-goldenY);

 score-=distX*300;
 score-=distY*300;

 if(distX>0.08){
   if(centerX<0.5)tips.push("å¾€å³ç§»åŠ¨ä¸€ç‚¹ ğŸ‘‰");
   else tips.push("å¾€å·¦ç§»åŠ¨ä¸€ç‚¹ ğŸ‘ˆ");
 }

 if(distY>0.08){
   if(eyeY<goldenY)tips.push("é•œå¤´å¾€ä¸‹ä¸€ç‚¹ â¬‡");
   else tips.push("é•œå¤´å¾€ä¸Šä¸€ç‚¹ â¬†");
 }

 // ===== 45Â° ä¾§èº«æ˜¾ç˜¦æ£€æµ‹ =====
 // æ­£é¢æ—¶ shoulderWidth æ¥è¿‘ hipWidth
 // ä¾§èº«æ—¶ shoulderWidth ä¼šæ˜æ˜¾å˜çª„

 if(bodyThicknessRatio>0.9){
   tips.push("ç¨å¾®ä¾§èº« 30Â°-45Â° æ›´æ˜¾ç˜¦ â†©ï¸");
   score-=15;
 }
 else if(bodyThicknessRatio<0.6){
   tips.push("ä¾§èº«å¾ˆå¥½ï¼Œå¾ˆæ˜¾ç˜¦ ğŸ‘");
   score+=10;
 }

 if(score<0)score=0;
 if(score>100)score=100;

 currentScore=score;

 const tipText=document.getElementById("tipText");
 const scoreText=document.getElementById("scoreText");
 const readyHint=document.getElementById("readyHint");

 tipText.innerText=tips.length===0?"æ„å›¾+è§’åº¦éƒ½å¾ˆå¥½ ğŸ‘":tips.join(" | ");
 scoreText.innerText="è¯„åˆ†ï¼š"+Math.round(score);

 if(score>=90){
   shutterBtn.style.background="lime";
   readyHint.style.display="block";
 }else{
   shutterBtn.style.background="red";
   readyHint.style.display="none";
 }
}

const camera=new Camera(video,{
 onFrame:async()=>await pose.send({image:video}),
 width:640,
 height:480
});
camera.start();

shutterBtn.addEventListener("click",()=>{
 if(currentScore<80){
   alert("å†å¾®è°ƒä¸€ä¸‹ä¼šæ›´å¥½ ğŸ‘");
   return;
 }
 const link=document.createElement("a");
 link.download="slim-photo.png";
 link.href=canvas.toDataURL("image/png");
 link.click();
});
</script>

</body>
</html>
